<!-- src/templates/dashboard.html -->
<div class="bg-white p-8 rounded-lg shadow-md">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">داشبورد مدیریت</h1>
        <button id="add-post-btn" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">
            افزودن پست جدید
        </button>
    </div>

    <!-- Post List -->
    <div id="post-list" class="space-y-4">
        <!-- Posts will be loaded here dynamically -->
    </div>
</div>

<!-- Modal for Add/Edit Post -->
<div id="post-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
    <div class="relative top-20 mx-auto p-5 border w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">افزودن/ویرایش پست</h3>
            <div class="mt-2 px-7 py-3">
                <form id="post-form">
                    <input type="hidden" id="post-id">
                    <input type="text" id="post-title" placeholder="عنوان پست" class="w-full px-3 py-2 mb-3 text-gray-700 border rounded-lg focus:outline-none">
                    <input type="text" id="post-slug" placeholder="اسلاگ (slug)" class="w-full px-3 py-2 mb-3 text-gray-700 border rounded-lg focus:outline-none">
                    <textarea id="post-excerpt" placeholder="خلاصه پست" rows="3" class="w-full px-3 py-2 mb-3 text-gray-700 border rounded-lg focus:outline-none"></textarea>
                    <textarea id="post-content" placeholder="محتوای کامل پست" rows="10" class="w-full px-3 py-2 mb-3 text-gray-700 border rounded-lg focus:outline-none"></textarea>
                </form>
            </div>
            <div class="items-center px-4 py-3">
                <button id="save-post-btn" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-300">
                    ذخیره
                </button>
                <button id="cancel-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-auto shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
                    انصراف
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const apiToken = 'my-secret-token'; // This should be handled more securely in a real app
        const postList = document.getElementById('post-list');
        const modal = document.getElementById('post-modal');
        const addPostBtn = document.getElementById('add-post-btn');
        const savePostBtn = document.getElementById('save-post-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const postForm = document.getElementById('post-form');
        const postIdInput = document.getElementById('post-id');

        // Function to fetch and display posts
        async function loadPosts() {
            const response = await fetch('/api/posts');
            const posts = await response.json();
            postList.innerHTML = posts.map(post => `
                <div class="flex justify-between items-center border p-4 rounded-lg">
                    <div>
                        <h2 class="text-xl font-semibold">${post.title}</h2>
                        <p class="text-sm text-gray-500">/${post.slug}</p>
                    </div>
                    <div>
                        <button class="edit-btn text-yellow-500 hover:text-yellow-600 mr-2" data-id="${post.id}">ویرایش</button>
                        <button class="delete-btn text-red-500 hover:text-red-600" data-id="${post.id}">حذف</button>
                    </div>
                </div>
            `).join('');
        }

        // Show/hide modal
        const showModal = () => modal.classList.remove('hidden');
        const hideModal = () => modal.classList.add('hidden');

        // Open modal for new post
        addPostBtn.addEventListener('click', () => {
            postForm.reset();
            postIdInput.value = '';
            document.getElementById('modal-title').innerText = 'افزودن پست جدید';
            showModal();
        });

        // Open modal for editing a post
        postList.addEventListener('click', async (e) => {
            if (e.target.classList.contains('edit-btn')) {
                const id = e.target.dataset.id;
                const response = await fetch(`/api/posts/${id}`);
                const post = await response.json();

                postIdInput.value = post.id;
                document.getElementById('post-title').value = post.title;
                document.getElementById('post-slug').value = post.slug;
                document.getElementById('post-excerpt').value = post.excerpt;
                document.getElementById('post-content').value = post.content;
                document.getElementById('modal-title').innerText = 'ویرایش پست';
                showModal();
            }
        });

        // Delete a post
        postList.addEventListener('click', async (e) => {
            if (e.target.classList.contains('delete-btn')) {
                const id = e.target.dataset.id;
                if (confirm('آیا از حذف این پست مطمئن هستید؟')) {
                    await fetch(`/api/posts/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${apiToken}` }
                    });
                    loadPosts();
                }
            }
        });

        // Save (create or update) a post
        savePostBtn.addEventListener('click', async () => {
            const id = postIdInput.value;
            const postData = {
                title: document.getElementById('post-title').value,
                slug: document.getElementById('post-slug').value,
                excerpt: document.getElementById('post-excerpt').value,
                content: document.getElementById('post-content').value,
                date: new Date().toISOString().split('T')[0]
            };

            const url = id ? `/api/posts/${id}` : '/api/posts';
            const method = id ? 'PUT' : 'POST';

            await fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiToken}`
                },
                body: JSON.stringify(postData)
            });

            hideModal();
            loadPosts();
        });

        cancelBtn.addEventListener('click', hideModal);

        // Initial load
        loadPosts();
    });
</script>
